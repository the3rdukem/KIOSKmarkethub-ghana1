TASK 2 — PASSWORD RESET UI & FLOW COMPLETION

MASTER PROMPT (Audit-First, Strict, Zero Feature Creep)

Context

The backend password reset system already exists and is verified:
	•	Secure token generation (hashed, expiring, single-use)
	•	Request + confirm API endpoints
	•	Email sending wired through sendEmail() abstraction
	•	No OTP involved
	•	No session auto-login after reset

What is missing:
	•	User-facing UI
	•	Proper user journey
	•	End-to-end usability validation

This task completes only the UI and flow wiring — nothing more.

⸻

STEP 0 — MANDATORY AUDIT (DO NOT SKIP)

Before writing any code:
	1.	Confirm existing API endpoints
	•	/api/auth/password-reset/request
	•	/api/auth/password-reset/confirm
	•	Expected payloads + responses
	2.	Confirm email usage
	•	Which template is used for password reset
	•	Required template variables
	•	Confirm reset URL format and token handling
	3.	Confirm auth rules
	•	User is NOT logged in after reset
	•	Token expires in 30 minutes
	•	Token is single-use

➡️ Summarize findings before implementing UI.

⸻

STEP 1 — PASSWORD RESET REQUEST PAGE

Create a page:

Route

/forgot-password

Requirements
	•	Single email input
	•	Submit button
	•	Clear success message:
“If an account exists, a password reset link has been sent.”
	•	No account existence disclosure
	•	Disabled button while submitting
	•	Client-side email validation (basic)

❌ Do NOT add CAPTCHA
❌ Do NOT add OTP
❌ Do NOT add rate limiting (already handled server-side / later)

⸻

STEP 2 — PASSWORD RESET CONFIRM PAGE

Create a page:

Route

/reset-password?token=XYZ

Requirements
	•	Password input
	•	Confirm password input
	•	Uses existing password strength rules
	•	Submits token + password to confirm endpoint
	•	Clear success state:
“Password reset successful. Please log in.”

Error handling
	•	Expired token
	•	Invalid token
	•	Already-used token
	•	Weak password

Errors must be user-friendly, not raw API errors.

⸻

STEP 3 — UX & SAFETY RULES

Strict rules:
	•	No auto-login
	•	No password visibility toggle unless already standard elsewhere
	•	No redirect loops
	•	No reuse of tokens
	•	No token stored in localStorage/sessionStorage
	•	Token read only from URL

⸻

STEP 4 — EMAIL LINK VALIDATION

Ensure:
	•	Reset email links correctly to /reset-password
	•	Token is passed correctly
	•	Clicking link twice fails gracefully

⸻

STEP 5 — REGRESSION GUARANTEES

You MUST verify:
	•	Login still works unchanged
	•	Registration unchanged
	•	Vendor flows unaffected
	•	Admin unaffected
	•	Email kill-switch still respected
	•	Dry-run mode still works

⸻

STEP 6 — EXIT REPORT (REQUIRED)

Return a concise report with:
	•	Audit summary
	•	Pages added
	•	API calls used
	•	Screens covered
	•	Failure cases tested
	•	Explicit confirmation:
“Password reset is now end-to-end functional.”

⸻

ABSOLUTE RULES

❌ No OTP
❌ No email verification
❌ No auth refactors
❌ No template changes (handled in Task 1)
❌ No Phase 5 work
❌ No UI redesigns beyond basic forms

⸻

STOP CONDITION

After Task 2:
	•	A real user can reset their password end-to-end
	•	Email + password reset are complete, usable, and auditable