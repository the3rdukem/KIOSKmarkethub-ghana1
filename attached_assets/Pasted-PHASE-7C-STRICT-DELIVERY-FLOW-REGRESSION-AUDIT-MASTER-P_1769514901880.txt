PHASE 7C ‚Äî STRICT DELIVERY FLOW REGRESSION AUDIT

MASTER PROMPT

‚∏ª

ROLE

You are acting as a Release & Risk Auditor, NOT a feature builder.

Your responsibility is to verify that the Phase 7B order & delivery refactor did NOT break anything.

You are explicitly FORBIDDEN from implementing, refactoring, improving, or fixing any behavior.

‚∏ª

üö´ GLOBAL RULES (NON-NEGOTIABLE)
	1.	‚ùå DO NOT WRITE OR MODIFY CODE
	2.	‚ùå DO NOT CREATE OR RUN MIGRATIONS
	3.	‚ùå DO NOT INSTALL PACKAGES
	4.	‚ùå DO NOT CHANGE SCHEMAS
	5.	‚ùå DO NOT IMPROVE UX OR UI
	6.	‚ùå DO NOT ADD DELIVERY FEATURES
	7.	‚ùå DO NOT ‚ÄúFIX‚Äù ISSUES ‚Äî ONLY REPORT THEM

If something is wrong:
	‚Ä¢	REPORT IT
	‚Ä¢	DO NOT FIX IT

Any violation = FAILED AUDIT.

‚∏ª

üéØ AUDIT OBJECTIVE

Confirm that the Phase 7B Order Status Refactor:
	‚Ä¢	Preserved all existing functionality
	‚Ä¢	Introduced no regressions
	‚Ä¢	Did not compromise payments, disputes, payouts, or permissions
	‚Ä¢	Is safe to build courier enablement on top of

This is a regression & safety audit, not a design review.

‚∏ª

üì¶ AUDIT SCOPE (STRICT ORDER ‚Äî DO NOT SKIP)

‚∏ª

1Ô∏è‚É£ LEGACY ORDER COMPATIBILITY

Verify:
	‚Ä¢	Orders created before Phase 7B still:
	‚Ä¢	Load correctly
	‚Ä¢	Display correct status
	‚Ä¢	Can transition forward normally
	‚Ä¢	Legacy statuses are normalized correctly:
	‚Ä¢	pending_payment
	‚Ä¢	processing
	‚Ä¢	shipped
	‚Ä¢	fulfilled

Confirm:
	‚Ä¢	No order is stuck in an unmappable state
	‚Ä¢	No silent failures during normalization

Report:
	‚Ä¢	Any order that cannot transition
	‚Ä¢	Any data loss or incorrect display

‚∏ª

2Ô∏è‚É£ PAYMENT ‚Üí ORDER STATUS INTEGRITY

Verify:
	‚Ä¢	Paystack webhook:
	‚Ä¢	Still updates payment_status = paid
	‚Ä¢	Still transitions order to confirmed
	‚Ä¢	No path exists where:
	‚Ä¢	Order advances without payment
	‚Ä¢	Payment success fails to update order status

Confirm:
	‚Ä¢	Refund markers do NOT auto-cancel orders
	‚Ä¢	Chargebacks do not auto-complete orders

‚∏ª

3Ô∏è‚É£ STATUS TRANSITION GUARDS

Verify:
	‚Ä¢	isValidStatusTransition() correctly enforces:
	‚Ä¢	Allowed transitions only
	‚Ä¢	Actor permissions (buyer / vendor / admin / system)
	‚Ä¢	Invalid transitions return:
	‚Ä¢	409 Conflict
	‚Ä¢	No partial updates

Test:
	‚Ä¢	Vendor skipping statuses
	‚Ä¢	Buyer attempting vendor actions
	‚Ä¢	Admin bypass behavior

Confirm:
	‚Ä¢	No status can be jumped
	‚Ä¢	No terminal state can be exited

‚∏ª

4Ô∏è‚É£ DELIVERY FLOW REGRESSION

Verify:
	‚Ä¢	Vendor must progress sequentially:
	‚Ä¢	preparing ‚Üí ready_for_pickup ‚Üí out_for_delivery ‚Üí delivered
	‚Ä¢	Vendor cannot:
	‚Ä¢	Mark delivered without out_for_delivery
	‚Ä¢	Complete an order manually

Confirm:
	‚Ä¢	Courier fields (courier_provider, courier_reference) are:
	‚Ä¢	Optional
	‚Ä¢	Non-blocking
	‚Ä¢	Not required to progress

‚∏ª

5Ô∏è‚É£ DISPUTE WINDOW ENFORCEMENT

Verify:
	‚Ä¢	Buyer can raise dispute only:
	‚Ä¢	After delivered
	‚Ä¢	Within 48 hours
	‚Ä¢	Dispute:
	‚Ä¢	Sets disputed_at
	‚Ä¢	Prevents auto-completion
	‚Ä¢	After 48 hours:
	‚Ä¢	Dispute endpoint is locked

Confirm:
	‚Ä¢	Buyer cannot dispute:
	‚Ä¢	Before delivery
	‚Ä¢	After completion
	‚Ä¢	Disputes do NOT auto-refund

‚∏ª

6Ô∏è‚É£ AUTO-COMPLETION SAFETY

Verify:
	‚Ä¢	Orders auto-transition to completed only when:
	‚Ä¢	Status is delivered
	‚Ä¢	No dispute exists
	‚Ä¢	48 hours have elapsed

Confirm:
	‚Ä¢	Auto-completion does NOT:
	‚Ä¢	Skip delivery
	‚Ä¢	Override disputes
	‚Ä¢	Affect unpaid orders

‚∏ª

7Ô∏è‚É£ PAYOUT & FINANCIAL ISOLATION

Verify:
	‚Ä¢	Order completion:
	‚Ä¢	Does NOT trigger payouts prematurely
	‚Ä¢	Disputed orders:
	‚Ä¢	Are excluded from payout eligibility
	‚Ä¢	Payment status remains:
	‚Ä¢	Fully independent of delivery flow

Confirm:
	‚Ä¢	No financial logic was altered unintentionally

‚∏ª

8Ô∏è‚É£ ROLE & PERMISSION SAFETY

Verify:
	‚Ä¢	Buyer:
	‚Ä¢	Can view statuses
	‚Ä¢	Can dispute (within window)
	‚Ä¢	Cannot change order state
	‚Ä¢	Vendor:
	‚Ä¢	Can only update fulfillment-related statuses
	‚Ä¢	Admin:
	‚Ä¢	Can override when required
	‚Ä¢	Leaves audit trail intact

Confirm:
	‚Ä¢	No permission leaks
	‚Ä¢	No admin routes exposed

‚∏ª

9Ô∏è‚É£ SYSTEM ISOLATION CHECK

Verify explicitly:
	‚Ä¢	Reviews unaffected
	‚Ä¢	Messaging unaffected
	‚Ä¢	Notifications unaffected
	‚Ä¢	PWA unaffected
	‚Ä¢	Admin site management unaffected

‚∏ª

üìÑ REQUIRED OUTPUT FORMAT (STRICT)

You MUST output ONLY this structure:

‚∏ª

üìã PHASE 7C ‚Äî DELIVERY FLOW REGRESSION AUDIT REPORT

A. Legacy Order Compatibility
Status: PASS / FAIL
Findings:

B. Payment ‚Üí Order Integrity
Status: PASS / FAIL
Findings:

C. Status Transition Guards
Status: PASS / FAIL
Findings:

D. Delivery Flow Regression
Status: PASS / FAIL
Findings:

E. Dispute Window Enforcement
Status: PASS / FAIL
Findings:

F. Auto-Completion Safety
Status: PASS / FAIL
Findings:

G. Payout & Financial Isolation
Status: PASS / FAIL
Findings:

H. Role & Permission Safety
Status: PASS / FAIL
Findings:

I. System Isolation
Status: PASS / FAIL
Findings:

‚∏ª

üö® CRITICAL ISSUES (IF ANY)
	‚Ä¢	List only launch-blocking issues
	‚Ä¢	If none, write: NONE

‚∏ª

‚úÖ PHASE 7C EXIT DECISION

Choose ONE:
	‚Ä¢	APPROVED ‚Äî SAFE TO BUILD DELIVERY FEATURES
	‚Ä¢	BLOCKED ‚Äî REGRESSION FIXES REQUIRED

Explain in max 5 lines.

‚∏ª

üõë FINAL STOP RULE

After the report:
	‚Ä¢	‚ùå DO NOT propose fixes
	‚Ä¢	‚ùå DO NOT suggest Phase 8
	‚Ä¢	‚ùå DO NOT implement anything

STOP AND WAIT.
